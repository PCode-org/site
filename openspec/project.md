# Project Context

## Purpose
Hagicode Documentation is a comprehensive documentation site built with Docusaurus 3.x, designed to provide user guides, feature documentation, and technical specifications for the Hagicode project. The site supports Chinese (Simplified) as the default and only language and serves as the primary source of truth for Hagicode users and contributors.

## Tech Stack
- **Docusaurus 3.0** - Static site generator and documentation framework
- **React 18.2** - UI library for custom components
- **TypeScript 5.3** - Type-safe configuration and component development
- **MDX (MDX.js 3.0)** - Enhanced markdown with JSX support
- **Node.js >=18.0** - Runtime environment
- **Prism React Renderer 2.3** - Syntax highlighting for code blocks (supports: bash, csharp, fsharp, powershell)
- **clsx 2.0** - Utility for className construction

## Project Conventions

### Code Style
- **TypeScript**: Use strict mode for all TypeScript files (configured in tsconfig.json)
- **File Naming**: Use kebab-case for markdown files (e.g., `session-management.md`)
- **Component Naming**: Use PascalCase for React components
- **CSS**: Use CSS custom properties (variables) defined in `src/css/custom.css`
- **Frontmatter**: All markdown documents must include `title` and `description` in frontmatter
- **Path Aliases**: Use `@/*` for src directory imports (configured in tsconfig.json)
- **Mermaid Diagrams**: Use Mermaid for diagrams that need version control and theme support
  - Flowcharts, state diagrams, sequence diagrams for technical content
  - Use mermaid code blocks with proper syntax
  - Keep diagrams simple (under 20 nodes recommended)
  - Static images reserved for highly complex visualizations

### Architecture Patterns

**Documentation Structure**
- `docs/` - Main documentation content (Chinese/Simplified)
  - `quick-start/` - Quick start guides (installation, project creation, sessions)
  - `_category_.json` - Category metadata configuration
- `blog/` - Blog posts with date-based naming (`YYYY-MM-DD-title.md`)
- `static/` - Static assets (images, favicons)
  - `img/` - Image assets (logo.svg, favicon.ico, social cards)
- `src/` - Custom React components and styles
  - `css/custom.css` - Custom CSS variables and theme overrides
  - `pages/` - Custom React pages
- `openspec/` - OpenSpec specification-driven development
  - `specs/` - Current specifications (what IS built)
  - `changes/` - Active proposals (what SHOULD change)
  - `changes/archive/` - Completed/archived changes
  - `AGENTS.md` - OpenSpec workflow instructions for AI assistants
  - `PROPOSAL_DESIGN_GUIDELINES.md` - UI and code flow visualization standards

**Sidebar Organization**
- Single sidebar configured in `sidebars.ts`: `docsSidebar`
- Uses autogenerated subcategories with `type: 'autogenerated'`
- Categories use `_category_.json` for metadata (label, position, collapsible)
- Generated index pages for category landing pages
- Only Quick Start category currently configured

**Internationalization**
- Default locale: Simplified Chinese (`zh-CN`)
- Supported locales: Single locale only (`zh-CN`)
- All content is in Chinese and located in `docs/`
- No i18n configuration (single-language site)
- No language switcher in navbar
- URLs do not include locale prefix (e.g., `/docs/quick-start/installation`)

**OpenSpec Integration**
- Spec-driven development workflow using OpenSpec
- Proposals require `proposal.md`, `tasks.md`, and spec deltas
- Design documents (`design.md`) for complex changes
- Validation with `openspec validate --strict` before implementation
- Archiving workflow: `changes/` → `changes/archive/YYYY-MM-DD-name/`

### Testing Strategy
- **Local Development**: Always test with `npm start` before committing
- **Production Build**: Validate with `npm run build` to ensure no build errors
- **Type Checking**: Run `npm run typecheck` to verify TypeScript correctness
- **Link Validation**: Set `onBrokenLinks: 'throw'` in config to catch broken links
- **OpenSpec Validation**: Run `openspec validate --strict` for all proposals

### Git Workflow
- **Main Branch**: `main`
- **Feature Branches**: Create from `main`, descriptive names (e.g., `add-session-docs`)
- **Commit Conventions**: Clear, descriptive messages in imperative mood
- **OpenSpec Integration**: Use OpenSpec for significant changes (see openspec/AGENTS.md)
- **PR Process**: All changes go through pull requests with local testing required
- **Archive Workflow**: After deployment, create separate PR to archive changes

## Domain Context

**Hagicode** is an AI-powered code-related tool/application with the following key feature areas:

**Core Features**
- **Session Management**: Managing sessions, concurrency, and session details
- **Conversation Features**: Message rendering, tool calls, todo tasks, view modes
- **Project Management**: Project lists, details, and creation

**Session Types**
- **Conversation Sessions**: Chat-like interaction with AI (similar to VS Code Copilot Chat, Cursor AI)
  - Read-only mode: AI can read, analyze, describe but not modify
  - Edit mode: AI can make code changes
- **Idea Sessions**: Idea-to-execution workflow (proposal-based)

**OpenSpec Integration**
- Proposal creation workflow
- Diagrams and annotations support
- Spec-driven development process
- Project.md optimization capabilities

**Configuration & UX**
- Config panel, project settings, notification settings
- Themes, languages, appearance customization
- Statistics & Achievements: Usage statistics, efficiency ratings

## Important Constraints
- **Node.js Version**: Requires Node.js >=18.0 (defined in package.json engines)
- **Build Compatibility**: All changes must pass `npm run build` without errors
- **Type Safety**: TypeScript must pass `tsc --noEmit` without errors (strict mode enabled)
- **Link Integrity**: Broken links cause build failures (onBrokenLinks: 'throw')
- **OpenSpec Compliance**: Significant changes require OpenSpec proposals (see AGENTS.md)
- **Single Language**: Site is Chinese-only; no language switching functionality

## Documentation Content Areas

### Quick Start (Current Content)
- Installation Guide (安装指南)
- Create Your First Project (创建你的第一个项目)
- Creating a Conversation Session (创建普通会话)
- Creating a Proposal Session (创建提案会话)

### Planned Content Areas
- Session Management (session-list, session-details, session-chat, concurrency)
- Conversation Features (message-rendering, tool-calls, todo-tasks, view-modes)
- Project Management (project-list, project-details)
- OpenSpec Proposals (overview, creating-proposals, diagrams, annotations)
- Statistics & Achievements (usage-statistics, efficiency-rating)
- Configuration (config-panel, project-settings, notification-settings)
- User Guide (appearance/themes, settings/overview)

## External Dependencies
- **GitHub**: Repository hosting (https://github.com/Hagicode-org/hagicode-docs)
- **Docusaurus Framework**:
  - @docusaurus/core ^3.0.0
  - @docusaurus/preset-classic ^3.0.0
  - @docusaurus/theme-classic ^3.0.0
  - @docusaurus/module-type-aliases ^3.0.0
  - @docusaurus/tsconfig ^3.0.0
- **React Ecosystem**:
  - react ^18.2.0
  - react-dom ^18.2.0
  - @mdx-js/react ^3.0.0
- **Development**:
  - typescript ~5.3.0
  - @types/node ^20.0.0
  - @types/react ^18.2.0
  - @types/react-dom ^18.2.0
- **Utilities**:
  - clsx ^2.0.0 (className utilities)
  - prism-react-renderer ^2.3.0 (syntax highlighting)

## OpenSpec Integration Details

This project uses OpenSpec for spec-driven development. Key points:
- Proposals are managed in `openspec/changes/`
- Specifications live in `openspec/specs/`
- Archive of completed changes in `openspec/changes/archive/`
- See `openspec/AGENTS.md` for detailed workflow instructions
- Design guidelines in `openspec/PROPOSAL_DESIGN_GUIDELINES.md`
- Always check `openspec list` and `openspec list --specs` before starting work

### OpenSpec Workflow Stages

**Stage 1: Creating Changes**
- Review `openspec/project.md`, existing specs, and changes
- Choose unique verb-led `change-id` (e.g., `add-feature`, `update-behavior`)
- Scaffold: `proposal.md`, `tasks.md`, optional `design.md`, and spec deltas
- Draft spec deltas using `## ADDED|MODIFIED|REMOVED Requirements`
- Run `openspec validate <id> --strict` before requesting approval

**Stage 2: Implementing Changes**
- Read proposal.md, design.md (if exists), and tasks.md
- Implement tasks sequentially
- Update checklist after all work is complete
- Do not start implementation until proposal is approved

**Stage 3: Archiving Changes**
- Move `changes/[name]/` → `changes/archive/YYYY-MM-DD-[name]/`
- Update `specs/` if capabilities changed
- Use `openspec archive <change-id> --skip-specs --yes` for tooling-only changes

## Development Scripts

```bash
npm start              # Start development server (localhost:3000)
npm run build          # Create production build
npm run serve          # Serve production build locally
npm run typecheck      # TypeScript type checking (tsc --noEmit)
npm run clear          # Clear Docusaurus cache
```

## Deployment

### GitHub Actions CI/CD

The project uses GitHub Actions for continuous deployment to GitHub Pages:

**Workflow Configuration**: `.github/workflows/deploy.yml`
- **Trigger**: Automatic on push to `main` branch
- **Node.js Version**: 18.x (matches `package.json` engines requirement)
- **Build Steps**:
  - `npm ci` - Install dependencies with exact versions
  - `npm run build` - Generate static site to `build/` directory
- **Deployment**: Uses `peaceiris/actions-gh-pages@v3` action
- **Target Branch**: `gh-pages`

**GitHub Configuration Required**:
- Enable GitHub Pages in repository settings
- Set source to `gh-pages` branch
- Grant GitHub Actions permissions: `contents: write`, `pages: write`, `id-token: write`

**Manual Deployment** (for development):
```bash
npm run build  # Build the site
npm run serve  # Preview production build locally
```

### Deployment Considerations
- Static site deployment compatible (GitHub Pages, Netlify, Vercel)
- Build output directory: `build/`
- Site is single-language (Chinese only)
- No i18n configuration needed
- URLs are clean without locale prefix

## Configuration Files

### docusaurus.config.ts
- Site configuration with TypeScript types
- Navbar: Docs dropdown, Blog link, GitHub link
- No language switcher (single-language site)
- Broken links: throw error on build failure
- Edit URL: GitHub repository
- Custom CSS: src/css/custom.css

### tsconfig.json
- Target: ES2020
- Strict mode enabled
- Path aliases: `@/*` → `src/*`
- JSX: react
- Module resolution: node
- Includes: src/, docusaurus.config.ts

### sidebars.ts
- Single sidebar: docsSidebar
- Quick Start category with autogenerated items
- Generated index page for Quick Start

## Rollback Instructions

To restore bilingual support (English + Chinese) if needed:

1. Restore the i18n directory from git history:
   ```bash
   git checkout b0f4586^ -- i18n/
   ```

2. Move Chinese content back to i18n:
   ```bash
   mv docs/quick-start/ i18n/zh-CN/docusaurus-plugin-content-docs/current/
   ```

3. Restore English content from git history:
   ```bash
   git checkout b0f4586^ -- docs/
   ```

4. Restore docusaurus.config.ts i18n configuration:
   ```typescript
   i18n: {
     defaultLocale: 'en',
     locales: ['en', 'zh-CN'],
     localeConfigs: {
       en: { label: 'English' },
       'zh-CN': { label: '简体中文' },
     },
   },
   ```

5. Add language switcher back to navbar:
   ```typescript
   {
     type: 'localeDropdown',
     position: 'right',
   },
   ```

6. Clear cache and rebuild:
   ```bash
   npm run clear
   npm run build
   ```

## Recent Changes

### 2026-01-14: Brand Rename - PCode to Hagicode
- Updated all product name references from "PCode" to "Hagicode" across the entire documentation site
- Updated site configuration (title, tagline, metadata) in `docusaurus.config.ts`
- Updated project information in `package.json`
- Updated GitHub organization references from `PCode-org` to `Hagicode-org`
- Updated GitHub repository URLs to `https://github.com/Hagicode-org/hagicode-docs`
- Updated all documentation content (Markdown files in `docs/` directory)
- Updated homepage components and text
- Updated footer copyright text
- Note: Files in `openspec/changes/archive/` represent historical records and retain "PCode" references for accuracy

### 2026-01-12: Set Chinese as Default Language
- Migrated from bilingual (English + Chinese) to single-language (Chinese only)
- Moved Chinese content from `i18n/zh-CN/docusaurus-plugin-content-docs/current/` to `docs/`
- Removed i18n configuration from docusaurus.config.ts
- Removed language switcher from navbar
- URLs no longer include locale prefix

### Previous Changes
See `openspec/changes/archive/` for detailed history of all completed changes including:
- Docusaurus site initialization
- Chinese documentation structure
- Quick start guides (installation, project creation, sessions)
- Language switcher (now removed)
- Simplified docs structure
