# 消息渲染

消息渲染功能负责以丰富、易读的方式显示对话中的各种消息内容。

## 功能概述

消息渲染提供了以下功能：

- **Markdown 渲染**：支持完整的 Markdown 语法
- **代码高亮**：自动识别编程语言并应用语法高亮
- **图表渲染**：支持 Mermaid 图表和流程图
- **富文本格式**：支持粗体、斜体、列表等富文本格式
- **安全渲染**：防止 XSS 攻击的安全内容渲染

## Markdown 支持

### 基础语法

- **标题**：`# H1` 到 `###### H6`
- **粗体**：`**粗体文本**`
- **斜体**：`*斜体文本*`
- **删除线**：`~~删除线~~`
- **引用**：`> 引用文本`

### 列表

- **无序列表**：使用 `-` 或 `*`
- **有序列表**：使用 `1.`
- **任务列表**：使用 `- [ ]` 和 `- [x]`

### 代码

- **行内代码**：使用反引号 `` `代码` ``
- **代码块**：使用三个反引号 \`\`\` 并指定语言

\`\`\`typescript
function hello() {
  console.log("Hello, World!");
}
\`\`\`

### 表格

```markdown
| 列1 | 列2 | 列3 |
|-----|-----|-----|
| 数据1 | 数据2 | 数据3 |
```

### 链接和图片

- **链接**：`[链接文本](https://example.com)`
- **图片**：`![alt 文本](图片 URL)`

## 代码高亮

消息渲染器支持以下编程语言的语法高亮：

- TypeScript / JavaScript
- Python
- C# / .NET
- Java
- Go
- Rust
- HTML / CSS / SCSS
- JSON / YAML
- SQL
- Shell / Bash
- 以及更多...

## Mermaid 图表

### 支持的图表类型

- **流程图**：使用 `graph` 或 `flowchart`
- **序列图**：使用 `sequenceDiagram`
- **甘特图**：使用 `gantt`
- **类图**：使用 `classDiagram`
- **状态图**：使用 `stateDiagram`
- **实体关系图**：使用 `erDiagram`
- **用户旅程图**：使用 `journey`

### 示例流程图

\`\`\`mermaid
graph TD
    A[开始] --> B{决策}
    B -->|是| C[执行操作 A]
    B -->|否| D[执行操作 B]
    C --> E[结束]
    D --> E
\`\`\`

### 全屏查看

点击 Mermaid 图表可以打开全屏查看器，提供更好的查看体验：

- 放大和缩小
- 平移查看大型图表
- 导出为图片

## 增强渲染功能

### LaTeX 公式

支持数学公式的渲染：

- **行内公式**：使用 `$E = mc^2$`
- **块级公式**：使用 `$$公式$$`

### 注释文本

支持带有注释的文本渲染：

- **注释标记**：特殊的注释标记
- **注释样式**：不同的视觉样式区分注释
- **注释预览**：悬停显示注释详情

## 安全性

消息渲染器实现了以下安全措施：

- **XSS 防护**：过滤危险的 HTML 和脚本
- **内容净化**：使用 DOMPurify 净化 HTML
- **CSP 支持**：与内容安全策略兼容

## 性能优化

- **虚拟滚动**：大量消息时使用虚拟滚动提升性能
- **懒加载**：图片和图表按需加载
- **缓存**：渲染结果缓存以提升重复内容性能

## 自定义样式

### 主题适配

消息渲染器自动适配当前主题：

- **浅色主题**：使用浅色主题样式
- **深色主题**：使用深色主题样式
- **动态切换**：实时响应主题切换

### 代码块样式

代码块支持多种主题样式：

- VS Code Dark
- GitHub Light
- Monokai
- Dracula

## 相关功能

- [工具调用](./tool-calls.md) - 查看工具调用的显示方式
- [待办任务](./todo-tasks.md) - 了解待办任务的渲染
- [视图模式](./view-modes.md) - 切换不同的消息显示模式
