<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-installation/docker-compose" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Docker Compose 部署 | Hagicode Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pcode-org.github.io/site/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://pcode-org.github.io/site/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://pcode-org.github.io/site/docs/installation/docker-compose"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Docker Compose 部署 | Hagicode Documentation"><meta data-rh="true" name="description" content="使用 Docker Compose 一键部署完整的 Hagicode 系统"><meta data-rh="true" property="og:description" content="使用 Docker Compose 一键部署完整的 Hagicode 系统"><link data-rh="true" rel="icon" href="/site/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pcode-org.github.io/site/docs/installation/docker-compose"><link data-rh="true" rel="alternate" href="https://pcode-org.github.io/site/docs/installation/docker-compose" hreflang="en"><link data-rh="true" rel="alternate" href="https://pcode-org.github.io/site/docs/installation/docker-compose" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"安装指南","item":"https://pcode-org.github.io/site/docs/installation"},{"@type":"ListItem","position":2,"name":"Docker Compose 部署","item":"https://pcode-org.github.io/site/docs/installation/docker-compose"}]}</script><link rel="alternate" type="application/rss+xml" href="/site/blog/rss.xml" title="Hagicode Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/site/blog/atom.xml" title="Hagicode Documentation Atom Feed">





<script src="data:text/javascript;charset=utf-8,window.__CLARITY_PROJECT_ID__=&quot;v0s9trs6i6&quot;;"></script><link rel="stylesheet" href="/site/assets/css/styles.c9eb974e.css">
<script src="/site/assets/js/runtime~main.27a2490f.js" defer="defer"></script>
<script src="/site/assets/js/main.22ca8318.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/site/"><b class="navbar__title text--truncate">PCode Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/site/docs/installation">Docs</a><a class="navbar__item navbar__link" href="/site/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://qm.qq.com/q/Wk6twXHdyS" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">QQ群<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/Hagicode-org/hagicode-docs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/site/docs/installation"><span title="安装指南" class="categoryLinkLabel_W154">安装指南</span></a><button aria-label="Collapse sidebar category &#x27;安装指南&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/site/docs/installation/docker-compose"><span title="Docker Compose 部署" class="linkLabel_WmDU">Docker Compose 部署</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/site/docs/installation/package-deployment"><span title="软件包部署" class="linkLabel_WmDU">软件包部署</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/site/docs/quick-start"><span title="Quick Start" class="categoryLinkLabel_W154">Quick Start</span></a><button aria-label="Expand sidebar category &#x27;Quick Start&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/site/docs/related-software-installation"><span title="相关软件安装" class="categoryLinkLabel_W154">相关软件安装</span></a><button aria-label="Expand sidebar category &#x27;相关软件安装&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article data-clarity-region="article"><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/site/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/site/docs/installation"><span>安装指南</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Docker Compose 部署</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_bxCs"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Docker Compose 部署</h1></header>
<p>本指南介绍如何使用 Docker Compose 一键部署完整的 Hagicode 系统。这是<strong>推荐的部署方式</strong>，适合大多数用户，特别是开发、测试和生产环境。</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>推荐方式</div><div class="admonitionContent_BuS1"><p>Docker Compose 部署是首选的安装方式，具有以下优势：</p><ul>
<li class="">环境隔离，避免依赖冲突</li>
<li class="">一键启动所有服务（PostgreSQL + Hagicode）</li>
<li class="">易于管理和维护</li>
<li class="">适合快速体验和测试</li>
</ul></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="前置要求">前置要求<a href="#前置要求" class="hash-link" aria-label="Direct link to 前置要求" title="Direct link to 前置要求" translate="no">​</a></h2>
<p>在开始之前，请确保您的系统已安装 Docker 和 Docker Compose。</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="安装-docker">安装 Docker<a href="#安装-docker" class="hash-link" aria-label="Direct link to 安装 Docker" title="Direct link to 安装 Docker" translate="no">​</a></h3>
<div class="theme-tabs-container tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Windows</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">macOS</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Linux</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><p>下载并安装 <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noopener noreferrer" class="">Docker Desktop for Windows</a></p><p>安装完成后，确保 Docker Desktop 正在运行。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>下载并安装 <a href="https://www.docker.com/products/docker-desktop/" target="_blank" rel="noopener noreferrer" class="">Docker Desktop for Mac</a></p><p>安装完成后，确保 Docker Desktop 正在运行。</p></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><p>使用您的包管理器安装 Docker：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_OeMC">在 Ubuntu/Debian 上安装 Docker</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">apt-get</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">install</span><span class="token plain"> docker.io docker-compose-plugin</span><br></span></code></pre></div></div><p>安装完成后，启动 Docker 服务：</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> systemctl start </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">enable</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><br></span></code></pre></div></div></div></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="验证安装">验证安装<a href="#验证安装" class="hash-link" aria-label="Direct link to 验证安装" title="Direct link to 验证安装" translate="no">​</a></h3>
<p>安装完成后，运行以下命令验证 Docker 和 Docker Compose 是否正确安装：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">--version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose version</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="快速开始">快速开始<a href="#快速开始" class="hash-link" aria-label="Direct link to 快速开始" title="Direct link to 快速开始" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-准备-docker-composeyml-文件">1. 准备 docker-compose.yml 文件<a href="#1-准备-docker-composeyml-文件" class="hash-link" aria-label="Direct link to 1. 准备 docker-compose.yml 文件" title="Direct link to 1. 准备 docker-compose.yml 文件" translate="no">​</a></h3>
<p>从 Hagicode 仓库下载 <code>docker-compose.yml</code> 文件，或者使用以下示例创建：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_OeMC">docker-compose.yml</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> newbe36524/hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">app</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ASPNETCORE_ENVIRONMENT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Production</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ASPNETCORE_URLS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">//+</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token number" style="color:rgb(247, 140, 108)">45000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">TZ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Asia/Shanghai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ConnectionStrings__Default</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Host=postgres;Port=5432;Database=hagicode;Username=postgres;Password=postgres&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">License__Activation__LicenseKey</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${HAGICODE_LICENSE_KEY:-D76B5C-EC0A70-AEA453-BC9414-0A198D-V3}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 用户和组 ID 配置（用于文件权限管理）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 详细说明请参考&quot;用户权限管理&quot;章节</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 将 1000 替换为您在宿主机的实际用户 ID 和组 ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># - PUID=1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># - PGID=1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 智谱 AI API Key（必须配置 - 容器部署必需）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 取消注释并设置您的密钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 购买链接：https://www.bigmodel.cn/claude-code?ic=14BY54APZA</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># ZAI_API_KEY: &quot;${ZAI_API_KEY}&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;45000:45000&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 主机路径映射：将主机目录挂载到容器中</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 这使您可以在主机上操作文件，容器内实时生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> /path/to/your/repos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/app/workdir</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">depends_on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token key atrule">condition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> service_healthy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pcode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CMD&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;curl&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-f&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;http://localhost:45000/&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 30s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 3s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">start_period</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 40s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bitnami/postgresql</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">container_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">postgres</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">POSTGRES_DATABASE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> hagicode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">POSTGRES_USER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">POSTGRES_PASSWORD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> postgres</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">POSTGRES_HOST_AUTH_METHOD</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> trust</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">TZ</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> Asia/Shanghai</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> postgres</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/bitnami/postgresql</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">healthcheck</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CMD&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;pg_isready&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-U&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;postgres&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">interval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 10s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">timeout</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> 3s</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">retries</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> pcode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">network</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">restart</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">postgres-data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token key atrule">networks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">pcode-network</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">driver</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> bridge</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>路径映射说明</div><div class="admonitionContent_BuS1"><p>Docker Compose 配置中包含了重要的路径映射：</p><ul>
<li class=""><strong>主机路径</strong>: <code>/path/to/your/repos</code>（请根据实际情况修改）</li>
<li class=""><strong>容器路径</strong>: <code>/app/workdir</code></li>
</ul><p>这种映射允许您在主机上直接操作文件，Hagicode 容器可以实时访问这些文件。请将 <code>/path/to/your/repos</code> 替换为您实际的代码仓库路径。</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-配置环境变量">2. 配置环境变量<a href="#2-配置环境变量" class="hash-link" aria-label="Direct link to 2. 配置环境变量" title="Direct link to 2. 配置环境变量" translate="no">​</a></h3>
<p>创建 <code>.env</code> 文件（与 <code>docker-compose.yml</code> 同目录）来配置敏感信息：</p>
<div class="language-env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_OeMC">.env</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-env codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Hagicode 许可证密钥（可选）</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 如果不设置，将使用公测阶段的通用密钥</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># HAGICODE_LICENSE_KEY=D76B5C-EC0A70-AEA453-BC9414-0A198D-V3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 智谱 AI API Key（必须配置）</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 获取方式：请访问智谱 AI 官网购买订阅后获取</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ZAI_API_KEY=your-zai-api-key-here</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>公测阶段通用密钥</div><div class="admonitionContent_BuS1"><p>Hagicode 当前处于公测阶段，提供以下通用激活密钥：</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">D76B5C-EC0A70-AEA453-BC9414-0A198D-V3</span><br></span></code></pre></div></div></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>必须配置智谱 AI API Key</div><div class="admonitionContent_BuS1"><p>Hagicode 容器部署必须使用智谱 AI 作为 Claude API 提供商。<strong>请先购买智谱 AI 订阅并获得 API Key</strong>。</p><p><strong>购买智谱 AI 订阅（10% 优惠链接）</strong>：<a href="https://www.bigmodel.cn/claude-code?ic=14BY54APZA" target="_blank" rel="noopener noreferrer" class="">https://www.bigmodel.cn/claude-code?ic=14BY54APZA</a></p><ul>
<li class="">建议购买 <strong>Coding Plan</strong> 作为日常使用，成本更优</li>
<li class="">初次体验可以购买 <strong>Lite 版本</strong>，价格更低</li>
</ul><p>购买后，在此地址创建 API Key：<a href="https://bigmodel.cn/usercenter/proj-mgmt/apikeys" target="_blank" rel="noopener noreferrer" class="">https://bigmodel.cn/usercenter/proj-mgmt/apikeys</a></p><p><strong>智谱 AI 优势</strong>：</p><ul>
<li class=""><strong>响应更快</strong>：优化的网络路由，国内访问更稳定</li>
<li class=""><strong>更好兼容</strong>：与 Hagicode 功能完美集成，支持全部特性</li>
<li class=""><strong>成本优势</strong>：相比直接使用 Anthropic API 更具性价比</li>
<li class=""><strong>本地化支持</strong>：针对中文用户优化的服务体验</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-启动服务">3. 启动服务<a href="#3-启动服务" class="hash-link" aria-label="Direct link to 3. 启动服务" title="Direct link to 3. 启动服务" translate="no">​</a></h3>
<p>在 <code>docker-compose.yml</code> 所在目录执行以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose up </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><br></span></code></pre></div></div>
<p>此命令将：</p>
<ul>
<li class="">下载并启动 PostgreSQL 容器</li>
<li class="">下载并启动 Hagicode 应用容器</li>
<li class="">创建并配置网络</li>
<li class="">初始化数据库连接</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-验证服务状态">4. 验证服务状态<a href="#4-验证服务状态" class="hash-link" aria-label="Direct link to 4. 验证服务状态" title="Direct link to 4. 验证服务状态" translate="no">​</a></h3>
<p>检查容器是否正在运行：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose </span><span class="token function" style="color:rgb(130, 170, 255)">ps</span><br></span></code></pre></div></div>
<p>您应该看到两个容器都处于 &quot;running&quot; 状态。</p>
<p>查看服务日志：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 查看所有服务日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose logs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 查看 Hagicode 服务日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose logs hagicode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 实时跟踪日志</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose logs </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-f</span><span class="token plain"> hagicode</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="配置说明">配置说明<a href="#配置说明" class="hash-link" aria-label="Direct link to 配置说明" title="Direct link to 配置说明" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="智谱-ai-api-密钥配置必须配置">智谱 AI API 密钥配置（必须配置）<a href="#智谱-ai-api-密钥配置必须配置" class="hash-link" aria-label="Direct link to 智谱 AI API 密钥配置（必须配置）" title="Direct link to 智谱 AI API 密钥配置（必须配置）" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>必须配置智谱 AI API Key</div><div class="admonitionContent_BuS1"><p>Hagicode 容器部署<strong>必须使用智谱 AI</strong> 作为 Claude API 提供商。</p><p><strong>购买智谱 AI 订阅（10% 优惠链接）</strong>：<a href="https://www.bigmodel.cn/claude-code?ic=14BY54APZA" target="_blank" rel="noopener noreferrer" class="">https://www.bigmodel.cn/claude-code?ic=14BY54APZA</a></p><ul>
<li class="">建议购买 <strong>Coding Plan</strong> 作为日常使用，成本更优</li>
<li class="">初次体验可以购买 <strong>Lite 版本</strong>，价格更低</li>
</ul><p>购买后，在此地址创建 API Key：<a href="https://bigmodel.cn/usercenter/proj-mgmt/apikeys" target="_blank" rel="noopener noreferrer" class="">https://bigmodel.cn/usercenter/proj-mgmt/apikeys</a></p><p><strong>智谱 AI 优势</strong>：</p><ul>
<li class=""><strong>响应更快</strong>：优化的网络路由，国内访问更稳定</li>
<li class=""><strong>更好兼容</strong>：与 Hagicode 功能完美集成，支持全部特性</li>
<li class=""><strong>成本优势</strong>：相比直接使用 Anthropic API 更具性价比</li>
<li class=""><strong>本地化支持</strong>：针对中文用户优化的服务体验</li>
</ul></div></div>
<p>智谱 AI API Key 的配置非常简单，只需在 <code>docker-compose.yml</code> 或 <code>.env</code> 文件中添加一个环境变量：</p>
<p>在 <code>docker-compose.yml</code> 中添加：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 智谱 AI API Key（必须配置）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 设置后将使用智谱 AI 优化的 Claude API 端点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token key atrule">ZAI_API_KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;${ZAI_API_KEY}&quot;</span><br></span></code></pre></div></div>
<p>或在 <code>.env</code> 文件中设置（推荐方式）：</p>
<div class="language-env codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_OeMC">.env</div><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-env codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 智  谱 AI API Key（必须配置）</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># 获取方式：请访问智谱 AI 官网购买订阅后获取</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ZAI_API_KEY=your-zai-api-key-here</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>最佳实践</div><div class="admonitionContent_BuS1"><ul>
<li class="">将智谱 AI API Key 配置在 <code>.env</code> 文件中，避免密钥泄露</li>
<li class="">重启容器后配置即可生效：<code>docker compose restart hagicode</code></li>
<li class="">配置后，Claude Code 将自动使用智谱 AI 优化的 API 端点</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="路径映射详解">路径映射详解<a href="#路径映射详解" class="hash-link" aria-label="Direct link to 路径映射详解" title="Direct link to 路径映射详解" translate="no">​</a></h3>
<p>路径映射（Volume Mounts）允许 Hagicode 容器访问主机上的代码仓库，这是容器部署的关键配置。</p>
<p><strong>为什么需要路径映射？</strong></p>
<p>Hagicode 需要访问您的代码仓库才能进行 AI 辅助编程：</p>
<ul>
<li class=""><strong>读取代码</strong>：AI 需要理解您的项目结构和代码</li>
<li class=""><strong>修改 代码</strong>：AI 生成的代码需要应用到您的项目中</li>
<li class=""><strong>实时同步</strong>：主机上的代码修改会立即反映到容器中</li>
</ul>
<p><strong>路径映射配置</strong>：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 代码工作目录映射（必需）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 请将 /path/to/your/repos 替换为您的实际代码仓库路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> /path/to/your/repos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain">/app/workdir</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>路径映射说明</div><div class="admonitionContent_BuS1"><ul>
<li class=""><code>/path/to/your/repos</code>：主机上的代码仓库路径（请根据实际情况修改）</li>
<li class=""><code>/app/workdir</code>：容器内的工作目录（固定路径，无需修改）</li>
<li class="">建议使用绝对路径，避免路径解析问题</li>
</ul></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="端口映射说明">端口映射说明<a href="#端口映射说明" class="hash-link" aria-label="Direct link to 端口映射说明" title="Direct link to 端口映射说明" translate="no">​</a></h3>
<p>Docker Compose 配置中的端口映射将容器端口暴露到主机：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;45000:5000&quot;</span><br></span></code></pre></div></div>
<p><strong>端口说明</strong>：</p>
<table><thead><tr><th>服务</th><th>容器端口</th><th>主机端口</th><th>用途</th></tr></thead><tbody><tr><td>Hagicode</td><td>5000</td><td>45000</td><td>Web 应用访问</td></tr></tbody></table>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><ul>
<li class=""><strong>PostgreSQL</strong> 不需要暴露到主机，Hagicode 容器通过内部网络 <code>pcode-network</code> 直接访问</li>
<li class="">如需从主机连接数据库，可以使用 <code>docker exec -it hagicode-postgres psql -U postgres -d hagicode</code></li>
</ul></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>端口冲突</div><div class="admonitionContent_BuS1"><p>如果主机端口已被占用，可以修改映射：</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;45001:5000&quot;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 使用 45001 代替 45000</span><br></span></code></pre></div></div></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="用  户权限管理">用户权限管理<a href="#用户权限管理" class="hash-link" aria-label="Direct link to 用户权限管理" title="Direct link to 用户权限管理" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="为什么需要关注用户权限">为什么需要关注用户权限<a href="#为什么需要关注用户权限" class="hash-link" aria-label="Direct link to 为什么需要关注用户权限" title="Direct link to 为什么需要关注用户权限" translate="no">​</a></h3>
<p>在使用 Docker Compose 部署 Hagicode 时，容器内外用户权限的映射是一个重要的问题。如果不正确配置，可能会导致文件读写权限冲突。</p>
<p><strong>问题根源</strong>：</p>
<ul>
<li class=""><strong>用户 ID 映射不匹配</strong>：Docker 容器内的用户 ID 是通过 Hash Code 生成的，与宿主机的用户 ID 可能不一致</li>
<li class=""><strong>文件权限冲突</strong>：当使用 root 用户在宿主机创建目录并挂载到容器时，容器内的非 root 用户可能无法读写这些文件</li>
<li class=""><strong>权限不一致导致的问题</strong>：<!-- -->
<ul>
<li class="">容器内应用无法修改挂载目录中的文件</li>
<li class="">容器内创建的文件在宿主机上显示为不同所有者</li>
<li class="">影响正常的文件读写操作和开发体验</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="方案一用户-id-映射配置推荐">方案一：用户 ID 映射配置（推荐）<a href="#方案一用户-id-映射配置推荐" class="hash-link" aria-label="Direct link to 方案一：用户 ID 映射配置（推荐）" title="Direct link to 方案一：用户 ID 映射配置（推荐）" translate="no">​</a></h3>
<p>这是最安全和推荐的解决方案。通过配置环境变量 <code>PUID</code> 和 <code>PGID</code>，可以让容器内的进程以指定的用户 ID 和组 ID 运行，从而与宿主机的用户权限保持一致。</p>
<p><strong>配置 步骤</strong>：</p>
<ol>
<li class=""><strong>获取宿主机用户 ID 和组 ID</strong></li>
</ol>
<p>在宿主机上运行以下命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">id</span><span class="token plain"> username</span><br></span></code></pre></div></div>
<p>将 <code>username</code> 替换为您的实际用户名。如果使用 root 用户操作，可以创建一个非 root 用户：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 创建新用户（如果需要）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">useradd</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-m</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-s</span><span class="token plain"> /bin/bash hagicode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 获取用户 ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">id</span><span class="token plain"> hagicode</span><br></span></code></pre></div></div>
<p>输出示例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">uid=1000(hagicode) gid=1000(hagicode) groups=1000(hagicode)</span><br></span></code></pre></div></div>
<p>记下 <code>uid</code> 和 <code>gid</code> 的值（示例中为 1000）。</p>
<ol start="2">
<li class=""><strong>配置 docker-compose.yml</strong></li>
</ol>
<p>在 <code>docker-compose.yml</code> 的 <code>environment</code> 部分添加 <code>PUID</code> 和 <code>PGID</code> 环境变量：</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token key atrule">hagicode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token key atrule">environment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 用户和组 ID 配置（用于文件权限管理）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 请将 1000 替换为您在宿主机的实际用户 ID 和组 ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PUID=1000</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">-</span><span class="token plain"> PGID=1000</span><br></span></code></pre></div></div>
<ol start="3">
<li class=""><strong>重启容器使配置生效</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> compose restart hagicode</span><br></span></code></pre></div></div>
<ol start="4">
<li class=""><strong>验证配置</strong></li>
</ol>
<p>检查容器内用户是否正确配置：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> hagicode-app </span><span class="token function" style="color:rgb(130, 170, 255)">id</span><br></span></code></pre></div></div>
<p>应该显示您配置的用户 ID 和组 ID。</p>
<p><strong>适用场景</strong>：</p>
<ul>
<li class="">宿主机使用 root 用户操作</li>
<li class="">需要安全的权限配置</li>
<li class="">生产环境部署</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li class="">安全性高，符合最小权限原则</li>
<li class="">文件权限清晰，易于管理</li>
<li class="">适用于多用户环境</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li class="">需要额外配置步骤</li>
<li class="">需要了解用户 ID 和组 ID</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="方案二权限设置">方案二：权限设置<a href="#方案二权限设置" class="hash-link" aria-label="Direct link to 方案二：权限设置" title="Direct link to 方案二：权限设置" translate="no">​</a></h3>
<p>这是一个快速但不够安全的解决方案。通过直接设置目录权限为 777，允许所有用户读写，但不推荐用于生产环境。</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>安全警告</div><div class="admonitionContent_BuS1"><p>此方案仅适用于开发环境和测试环境。在生产环境中使用 777 权限存在安全风险，任何用户都可以读写目录中的文件。</p></div></div>
<p><strong>操作步骤</strong>：</p>
<ol>
<li class=""><strong>使用 root 创建工作目录</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">mkdir</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-p</span><span class="token plain"> /path/to/repos</span><br></span></code></pre></div></div>
<ol start="2">
<li class=""><strong>设置目录权限为 777</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">chmod</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">777</span><span class="token plain"> /path/to/repos</span><br></span></code></pre></div></div>
<ol start="3">
<li class=""><strong>验证权限</strong></li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-la</span><span class="token plain"> /path/to/repos</span><br></span></code></pre></div></div>
<p>输出示例：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">drwxrwxrwx 2 root root 4096 Jan 15 10:00 .</span><br></span></code></pre></div></div>
<p><strong>适用场景</strong>：</p>
<ul>
<li class="">开发环境</li>
<li class="">单用户环境</li>
<li class="">需要快速解决权限问题</li>
</ul>
<p><strong>优点</strong>：</p>
<ul>
<li class="">操作简单，快速解决</li>
<li class="">无需修改 Docker 配置</li>
</ul>
<p><strong>缺点</strong>：</p>
<ul>
<li class="">安全性较低，任何用户都可以读写</li>
<li class="">不适合生产环境</li>
<li class="">多用户环境可能存在风险</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="故障排除">故障排除<a href="#故障排除" class="hash-link" aria-label="Direct link to 故障排除" title="Direct link to 故障排除" translate="no">​</a></h3>
<p>以下是常见的权限问题及解决方法：</p>
<table><thead><tr><th>问题现象</th><th>可能原因</th><th>解决方案</th></tr></thead><tbody><tr><td>容器内无法写 文件</td><td>用户 ID 不匹配</td><td>配置 PUID/PGID 或设置目录权限</td></tr><tr><td>容器内创建的文件宿主机无法访问</td><td>所有者 ID 不一致</td><td>使用方案一配置用户 ID 映射</td></tr><tr><td>Permission denied 错误</td><td>文件或目录权限不足</td><td>检查并修改文件/目录权限</td></tr></tbody></table>
<p><strong>诊断命令</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 检查宿主机文件权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-la</span><span class="token plain"> /path/to/repos</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 检查容器内用户</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> hagicode-app </span><span class="token function" style="color:rgb(130, 170, 255)">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 检查容器内文件权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> hagicode-app </span><span class="token function" style="color:rgb(130, 170, 255)">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-la</span><span class="token plain"> /app/workdir</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 测试容器内文件写入</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> hagicode-app </span><span class="token function" style="color:rgb(130, 170, 255)">touch</span><span class="token plain"> /app/workdir/test.txt</span><br></span></code></pre></div></div>
<p><strong>预防权限问题的最佳实践</strong>：</p>
<ol>
<li class="">优先使用方案一（用户 ID 映射配置）</li>
<li class="">在宿主机上使用专用的非 root 用户运行 Hagicode</li>
<li class="">避免在生产环境使用 777 权  限</li>
<li class="">定期检查挂载目录的文件权限</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="访问应用">访问应用<a href="#访问应用" class="hash-link" aria-label="Direct link to 访问应用" title="Direct link to 访问应用" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="web-界面">Web 界面<a href="#web-界面" class="hash-link" aria-label="Direct link to Web 界面" title="Direct link to Web 界面" translate="no">​</a></h3>
<p>服务启动成功后，通过浏览器访问：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">http://localhost:45000</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="数据库连接">数据库连接<a href="#数据库连接" class="hash-link" aria-label="Direct link to 数据库连接" title="Direct link to 数据库连接" translate="no">​</a></h3>
<p>如果您需要直接连接到 PostgreSQL 数据库，可以通过 <code>docker exec</code> 命令进入容器：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># 进入 PostgreSQL 容器并连接到数据库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">docker</span><span class="token plain"> </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">exec</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-it</span><span class="token plain"> hagicode-postgres psql </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-U</span><span class="token plain"> postgres </span><span class="token parameter variable" style="color:rgb(191, 199, 213)">-d</span><span class="token plain"> hagicode</span><br></span></code></pre></div></div>
<p><strong>容器内连接信息</strong>：</p>
<ul>
<li class=""><strong>主机</strong>: <code>localhost</code> 或 <code>127.0.0.1</code>（容器内）</li>
<li class=""><strong>端口</strong>: <code>5432</code>（PostgreSQL 默认端口）</li>
<li class=""><strong>用户名</strong>: <code>postgres</code></li>
<li class=""><strong>密码</strong>: <code>postgres</code></li>
<li class=""><strong>数据库</strong>: <code>hagicode</code></li>
</ul>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>PostgreSQL 未暴露到主机端口，这样更安全且避免端口冲突。如需从主机访问数据库，请使用 <code>docker exec</code> 命令。</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="后续步骤">后续步骤<a href="#后续步骤" class="hash-link" aria-label="Direct link to 后续步骤" title="Direct link to 后续步骤" translate="no">​</a></h2>
<p>现在您已经成功部署了 Hagicode，请继续<a class="" href="/site/docs/quick-start/create-first-project">创建第一个项目</a>以开始使用。</p>
<p>如果您更喜欢使用软件包方式部署，请参阅<a class="" href="/site/docs/installation/package-deployment">软件包部署指南</a>。</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/Hagicode-org/hagicode-docs/tree/main/docs/installation/docker-compose.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/site/docs/installation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">安装指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/site/docs/installation/package-deployment"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">软件包部署</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#前置要求" class="table-of-contents__link toc-highlight">前置要求</a><ul><li><a href="#安装-docker" class="table-of-contents__link toc-highlight">安装 Docker</a></li><li><a href="#验证安装" class="table-of-contents__link toc-highlight">验证安装</a></li></ul></li><li><a href="#快速开始" class="table-of-contents__link toc-highlight">快速开始</a><ul><li><a href="#1-准备-docker-composeyml-文件" class="table-of-contents__link toc-highlight">1. 准备 docker-compose.yml 文件</a></li><li><a href="#2-配置环境变量" class="table-of-contents__link toc-highlight">2. 配置环境变量</a></li><li><a href="#3-启动服务" class="table-of-contents__link toc-highlight">3. 启动服务</a></li><li><a href="#4-验证服务状态" class="table-of-contents__link toc-highlight">4. 验证服务状态</a></li></ul></li><li><a href="#配置说明" class="table-of-contents__link toc-highlight">配置说明</a><ul><li><a href="#智谱-ai-api-密钥配置必须配置" class="table-of-contents__link toc-highlight">智谱 AI API 密钥配置（必须配置）</a></li><li><a href="#路径映射详解" class="table-of-contents__link toc-highlight">路径映射详解</a></li><li><a href="#端口映射说明" class="table-of-contents__link toc-highlight">端口映射说明</a></li></ul></li><li><a href="#用户权限管理" class="table-of-contents__link toc-highlight">用户权限管理</a><ul><li><a href="#为什么需要关注用户权限" class="table-of-contents__link toc-highlight">为什么需要关注用户权限</a></li><li><a href="#方案一用户-id-映射配置推荐" class="table-of-contents__link toc-highlight">方案一：用户 ID 映射配置（推荐）</a></li><li><a href="#方案二权限设置" class="table-of-contents__link toc-highlight">方案二：权限设置</a></li><li><a href="#故障排除" class="table-of-contents__link toc-highlight">故障排除</a></li></ul></li><li><a href="#访问应用" class="table-of-contents__link toc-highlight">访问应用</a><ul><li><a href="#web-界面" class="table-of-contents__link toc-highlight">Web 界面</a></li><li><a href="#数据库连接" class="table-of-contents__link toc-highlight">数据库连接</a></li></ul></li><li><a href="#后续步骤" class="table-of-contents__link toc-highlight">后续步骤</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Hagicode-org/hagicode-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://qm.qq.com/q/Wk6twXHdyS" target="_blank" rel="noopener noreferrer" class="footer__link-item">QQ技术支持群 (610394020)<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/site/blog">Blog</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 PCode. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>